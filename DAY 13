--EX3
WITH CTE AS 
(SELECT 
  policy_holder_id,
  COUNT(case_id) 
FROM callers
GROUP BY policy_holder_id
HAVING COUNT(case_id) >= '3')
SELECT 
  COUNT(*) AS policy_holder_count
FROM CTE
--EX4
SELECT 
  p.page_id
FROM pages AS p
LEFT JOIN page_likes AS l
ON p.page_id=l.page_id
WHERE liked_date IS NULL
ORDER BY page_id 
--EX5
--EX7
WITH CTE AS (
SELECT 
    product_id,
    MIN(year) AS first_year
FROM Sales
GROUP BY product_id
)
SELECT DISTINCT
    a.product_id,
    b.first_year,
    a.quantity,
    a.price
FROM CTE AS b
LEFT JOIN Sales AS a ON a.product_id=b.product_id AND 
 a.year=b.first_year
--EX8
WITH CTE AS (
    SELECT 
        customer_id, 
        COUNT(DISTINCT product_key) AS distinct_product_count
    FROM Customer
    GROUP BY customer_id
)
SELECT 
    customer_id
FROM CTE
WHERE distinct_product_count = (SELECT COUNT(*) FROM Product);
--EX9
